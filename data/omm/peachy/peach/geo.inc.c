#ifdef VSCODE
#include "model.inc.c"
#endif

static const GeoLayout omm_geo_peach_axes[] = {
    GEO_OPEN_NODE(),
        GEO_TRANSLATE_NODE(LAYER_OPAQUE, 10, 0, 0),
        GEO_OPEN_NODE(),
            GEO_PREPROCESS_PEACH_UP_VEC, // Compute Peach's up vector
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_OPEN_NODE(),
        GEO_TRANSLATE_NODE(LAYER_OPAQUE, 0, 10, 0),
        GEO_OPEN_NODE(),
            GEO_PREPROCESS_PEACH_FORWARD_VEC, // Compute Peach's forward vector
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_OPEN_NODE(),
        GEO_TRANSLATE_NODE(LAYER_OPAQUE, 0, 0, 10),
        GEO_OPEN_NODE(),
            GEO_PREPROCESS_PEACH_LATERAL_VEC, // Compute Peach's lateral vector
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

//
// Normal
//

static const GeoLayout omm_geo_peach_normal_head[] = {
    GEO_OPEN_NODE(),
        GEO_DISPLAY_LIST(LAYER_OPAQUE, omm_peach_normal_head_gfx),
        GEO_OPEN_NODE(),
            GEO_PREPROCESS_PEACH_HAIR_ROT, // Set Peach's hair rotation
            GEO_ROTATION_NODE(LAYER_OPAQUE, 0, 0, 0),
            GEO_OPEN_NODE(),
                GEO_DISPLAY_LIST(LAYER_OPAQUE, omm_peach_normal_hair_gfx),
            GEO_CLOSE_NODE(),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_normal_cap_on_off[] = {
    GEO_SWITCH_CASE(0, geo_switch_mario_cap_on_off),
    GEO_OPEN_NODE(),
        GEO_OPEN_NODE(),
            GEO_TRANSLATE_NODE(LAYER_OPAQUE, 145, -11, 0),
            GEO_OPEN_NODE(),
                GEO_PREPROCESS_PEACH_CROWN_TIARA, // Switch between Peach's crown and Tiara
                GEO_DISPLAY_LIST(LAYER_OPAQUE, omm_peach_normal_crown_gfx),
                GEO_DISPLAY_LIST(LAYER_OPAQUE, omm_peach_normal_tiara_gfx),
            GEO_CLOSE_NODE(),
        GEO_CLOSE_NODE(),
        GEO_OPEN_NODE(),
            GEO_DISPLAY_LIST(LAYER_OPAQUE, NULL),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_normal_eyes[] = {
    GEO_SWITCH_CASE(0, geo_switch_mario_eyes),
    GEO_OPEN_NODE(),
        GEO_DISPLAY_LIST(LAYER_ALPHA, omm_peach_normal_face_open_gfx),
        GEO_DISPLAY_LIST(LAYER_ALPHA, omm_peach_normal_face_half_gfx),
        GEO_DISPLAY_LIST(LAYER_ALPHA, omm_peach_normal_face_close_gfx),
        GEO_DISPLAY_LIST(LAYER_ALPHA, omm_peach_normal_face_joy_gfx),
        GEO_DISPLAY_LIST(LAYER_ALPHA, omm_peach_normal_face_rage_gfx),
        GEO_DISPLAY_LIST(LAYER_ALPHA, omm_peach_normal_face_gloom_gfx),
        GEO_DISPLAY_LIST(LAYER_ALPHA, omm_peach_normal_face_yeah_gfx),
        GEO_DISPLAY_LIST(LAYER_ALPHA, omm_peach_normal_face_hurt_gfx),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_normal_left_arm[] = {
    GEO_ANIMATED_PART(LAYER_OPAQUE, 40, -7, 47, NULL),
    GEO_OPEN_NODE(),
        GEO_ANIMATED_PART(LAYER_OPAQUE, 0, 0, 0, omm_peach_normal_arm1_left_gfx),
        GEO_OPEN_NODE(),
            GEO_ANIMATED_PART(LAYER_OPAQUE, 88, 0, -1, omm_peach_normal_arm2_left_gfx),
            GEO_OPEN_NODE(),
                GEO_SWITCH_CASE(1, geo_switch_mario_hand),
                GEO_OPEN_NODE(),
                    GEO_ANIMATED_PART(LAYER_OPAQUE, 82, 0, 0, omm_peach_normal_fist_left_gfx),
                    GEO_ANIMATED_PART(LAYER_OPAQUE, 82, 0, 0, omm_peach_normal_hand_left_gfx),
                    GEO_ANIMATED_PART(LAYER_OPAQUE, 82, 0, 0, omm_peach_normal_fist_left_gfx),
                    GEO_ANIMATED_PART(LAYER_OPAQUE, 82, 0, 0, omm_peach_normal_fist_left_gfx),
                    GEO_ANIMATED_PART(LAYER_OPAQUE, 82, 0, 0, omm_peach_normal_fist_left_gfx),
                GEO_CLOSE_NODE(),
            GEO_CLOSE_NODE(),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_normal_right_arm[] = {
    GEO_ANIMATED_PART(LAYER_OPAQUE, 40, -7, -47, NULL),
    GEO_OPEN_NODE(),
        GEO_ANIMATED_PART(LAYER_OPAQUE, 0, 0, 0, omm_peach_normal_arm1_right_gfx),
        GEO_OPEN_NODE(),
            GEO_ANIMATED_PART(LAYER_OPAQUE, 88, 0, 1, omm_peach_normal_arm2_right_gfx),
            GEO_OPEN_NODE(),
                GEO_HELD_OBJECT(0, 82, 0, 0, geo_switch_mario_hand_grab_pos),
                GEO_SWITCH_CASE(0, geo_switch_mario_hand),
                GEO_OPEN_NODE(),
                    GEO_ANIMATED_PART(LAYER_OPAQUE, 82, 0, 0, NULL),
                    GEO_OPEN_NODE(),
                        GEO_PREPROCESS_PEACH_HAND_ROT,
                        GEO_ROTATION_NODE_WITH_DL(LAYER_OPAQUE, 0, 0, 0, omm_peach_normal_fist_right_gfx),
                    GEO_CLOSE_NODE(),
                    GEO_ANIMATED_PART(LAYER_OPAQUE, 82, 0, 0, NULL),
                    GEO_OPEN_NODE(),
                        GEO_PREPROCESS_PEACH_HAND_ROT,
                        GEO_ROTATION_NODE_WITH_DL(LAYER_OPAQUE, 0, 0, 0, omm_peach_normal_hand_right_gfx),
                    GEO_CLOSE_NODE(),
                    GEO_ANIMATED_PART(LAYER_OPAQUE, 82, 0, 0, NULL),
                    GEO_OPEN_NODE(),
                        GEO_PREPROCESS_PEACH_HAND_ROT,
                        GEO_ROTATION_NODE_WITH_DL(LAYER_OPAQUE, 0, 0, 0, omm_peach_normal_peace_right_gfx),
                    GEO_CLOSE_NODE(),
                    GEO_ANIMATED_PART(LAYER_OPAQUE, 82, 0, 0, NULL),
                    GEO_OPEN_NODE(),
                        GEO_PREPROCESS_PEACH_HAND_ROT,
                        GEO_ROTATION_NODE_WITH_DL(LAYER_OPAQUE, 0, 0, 0, omm_peach_normal_fist_right_crown_gfx),
                    GEO_CLOSE_NODE(),
                    GEO_ANIMATED_PART(LAYER_OPAQUE, 82, 0, 0, NULL),
                    GEO_OPEN_NODE(),
                        GEO_PREPROCESS_PEACH_HAND_ROT,
                        GEO_ROTATION_NODE_WITH_DL(LAYER_OPAQUE, 0, 0, 0, omm_peach_normal_fist_right_tiara_gfx),
                    GEO_CLOSE_NODE(),
                GEO_CLOSE_NODE(),
            GEO_CLOSE_NODE(),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_normal_wings[] = {
    GEO_SCALE(LAYER_OPAQUE, 0x18000),
    GEO_OPEN_NODE(),
        GEO_SWITCH_CASE(0, geo_switch_mario_cap_on_off), // Use geo_switch_mario_cap_on_off to show/hide the wings in Peach's back
        GEO_OPEN_NODE(),
        GEO_CLOSE_NODE(),
        GEO_TRANSLATE_ROTATE(LAYER_OPAQUE, -48, -90, -40, 22, 0, -135),
        GEO_OPEN_NODE(),
            GEO_ASM(0, geo_mario_rotate_wing_cap_wings),
            GEO_ROTATION_NODE(LAYER_OPAQUE, 0, 0, 0),
            GEO_OPEN_NODE(),
                GEO_DISPLAY_LIST(LAYER_ALPHA, omm_peach_normal_wing_gfx),
            GEO_CLOSE_NODE(),
        GEO_CLOSE_NODE(),
        GEO_TRANSLATE_ROTATE(LAYER_OPAQUE, -48, -90, 40, -22, 0, -135),
        GEO_OPEN_NODE(),
            GEO_ASM(1, geo_mario_rotate_wing_cap_wings),
            GEO_ROTATION_NODE(LAYER_OPAQUE, 0, 0, 0),
            GEO_OPEN_NODE(),
                GEO_DISPLAY_LIST(LAYER_ALPHA, omm_peach_normal_wing_gfx),
            GEO_CLOSE_NODE(),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_normal_left_leg[] = {
    GEO_ANIMATED_PART(LAYER_OPAQUE, -103, -8, 32, NULL),
    GEO_OPEN_NODE(),
        GEO_PREPROCESS_PEACH_LEFT_LEG_POS, // Compute Peach's left leg position
        GEO_ANIMATED_PART(LAYER_OPAQUE, 0, 0, 0, omm_peach_normal_leg1_left_gfx),
        GEO_OPEN_NODE(),
            GEO_ANIMATED_PART(LAYER_OPAQUE, 68, -4, 0, omm_peach_normal_leg2_left_gfx),
            GEO_OPEN_NODE(),
                GEO_PREPROCESS_PEACH_LEFT_FOOT_POS, // Compute Peach's left foot position
                GEO_ANIMATED_PART(LAYER_OPAQUE, 90, 1, 0, NULL),
                GEO_OPEN_NODE(),
                    GEO_ROTATION_NODE(LAYER_OPAQUE, 0, 0, -20),
                    GEO_OPEN_NODE(),
                        GEO_SCALE_WITH_DL(LAYER_OPAQUE, 0x14000, omm_peach_normal_foot_left_gfx),
                    GEO_CLOSE_NODE(),
                GEO_CLOSE_NODE(),
            GEO_CLOSE_NODE(),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_normal_left_leg_hidden[] = {
    GEO_ANIMATED_PART(LAYER_OPAQUE, -103, -8, 32, NULL),
    GEO_OPEN_NODE(),
        GEO_PREPROCESS_PEACH_LEFT_LEG_POS, // Compute Peach's left leg position
        GEO_ANIMATED_PART(LAYER_OPAQUE, 0, 0, 0, NULL),
        GEO_OPEN_NODE(),
            GEO_ANIMATED_PART(LAYER_OPAQUE, 68, -4, 0, NULL),
            GEO_OPEN_NODE(),
                GEO_PREPROCESS_PEACH_LEFT_FOOT_POS, // Compute Peach's left foot position
                GEO_ANIMATED_PART(LAYER_OPAQUE, 90, 1, 0, NULL),
            GEO_CLOSE_NODE(),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_normal_right_leg[] = {
    GEO_ANIMATED_PART(LAYER_OPAQUE, -103, -8, -32, NULL),
    GEO_OPEN_NODE(),
        GEO_PREPROCESS_PEACH_RIGHT_LEG_POS, // Compute Peach's right leg position
        GEO_ANIMATED_PART(LAYER_OPAQUE, 0, 0, 0, omm_peach_normal_leg1_right_gfx),
        GEO_OPEN_NODE(),
            GEO_ANIMATED_PART(LAYER_OPAQUE, 68, -4, 0, omm_peach_normal_leg2_right_gfx),
            GEO_OPEN_NODE(),
                GEO_PREPROCESS_PEACH_RIGHT_FOOT_POS, // Compute Peach's right foot position
                GEO_ANIMATED_PART(LAYER_OPAQUE, 90, 1, 0, NULL),
                GEO_OPEN_NODE(),
                    GEO_ROTATION_NODE(LAYER_OPAQUE, 0, 0, -20),
                    GEO_OPEN_NODE(),
                        GEO_SCALE_WITH_DL(LAYER_OPAQUE, 0x14000, omm_peach_normal_foot_right_gfx),
                    GEO_CLOSE_NODE(),
                GEO_CLOSE_NODE(),
            GEO_CLOSE_NODE(),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_normal_right_leg_hidden[] = {
    GEO_ANIMATED_PART(LAYER_OPAQUE, -103, -8, -32, NULL),
    GEO_OPEN_NODE(),
        GEO_PREPROCESS_PEACH_RIGHT_LEG_POS, // Compute Peach's right leg position
        GEO_ANIMATED_PART(LAYER_OPAQUE, 0, 0, 0, NULL),
        GEO_OPEN_NODE(),
            GEO_ANIMATED_PART(LAYER_OPAQUE, 68, -4, 0, NULL),
            GEO_OPEN_NODE(),
                GEO_PREPROCESS_PEACH_RIGHT_FOOT_POS, // Compute Peach's right foot position
                GEO_ANIMATED_PART(LAYER_OPAQUE, 90, 1, 0, NULL),
            GEO_CLOSE_NODE(),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_normal_legs[] = {
    GEO_SWITCH_CASE(4, geo_switch_anim_state),
    GEO_OPEN_NODE(),

        // Show both legs
        GEO_TRANSLATE_NODE(LAYER_OPAQUE, 0, 0, 0),
        GEO_OPEN_NODE(),
            GEO_BRANCH(1, omm_geo_peach_normal_left_leg),
            GEO_BRANCH(1, omm_geo_peach_normal_right_leg),
        GEO_CLOSE_NODE(),

        // Show the left leg, hide the right leg
        GEO_TRANSLATE_NODE(LAYER_OPAQUE, 0, 0, 0),
        GEO_OPEN_NODE(),
            GEO_BRANCH(1, omm_geo_peach_normal_left_leg),
            GEO_BRANCH(1, omm_geo_peach_normal_right_leg_hidden),
        GEO_CLOSE_NODE(),

        // Show the right leg, hide the left leg
        GEO_TRANSLATE_NODE(LAYER_OPAQUE, 0, 0, 0),
        GEO_OPEN_NODE(),
            GEO_BRANCH(1, omm_geo_peach_normal_left_leg_hidden),
            GEO_BRANCH(1, omm_geo_peach_normal_right_leg),
        GEO_CLOSE_NODE(),

        // Hide both legs
        GEO_TRANSLATE_NODE(LAYER_OPAQUE, 0, 0, 0),
        GEO_OPEN_NODE(),
            GEO_BRANCH(1, omm_geo_peach_normal_left_leg_hidden),
            GEO_BRANCH(1, omm_geo_peach_normal_right_leg_hidden),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_normal_dress[] = {
    GEO_TRANSLATE_NODE(LAYER_OPAQUE, -15, 0, 0),
    GEO_OPEN_NODE(),
        GEO_PREPROCESS_PEACH_HIPS_ROT_AND_LEGS, // Compute and set Peach's hips rotation
        GEO_ROTATION_NODE(LAYER_OPAQUE, 0, 0, 0),
        GEO_OPEN_NODE(),
            GEO_DISPLAY_LIST(LAYER_OPAQUE, omm_peach_normal_hips_gfx),
            GEO_OPEN_NODE(),
                GEO_TRANSLATE_NODE(LAYER_OPAQUE, -96, -4, 0),
                GEO_OPEN_NODE(),
                    GEO_PREPROCESS_PEACH_DRESS_ROT, // Set Peach's dress rotation
                    GEO_ROTATION_NODE(LAYER_OPAQUE, 0, 0, 0),
                    GEO_OPEN_NODE(),
                        GEO_DISPLAY_LIST(LAYER_OPAQUE, omm_peach_normal_dress_gfx),
                    GEO_CLOSE_NODE(),
                GEO_CLOSE_NODE(),
            GEO_CLOSE_NODE(),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_normal[] = {
    GEO_ANIMATED_PART(LAYER_OPAQUE, 0, 140, 0, NULL),
    GEO_OPEN_NODE(),
        GEO_PREPROCESS_PEACH_TORSO_POS, // Compute Peach's torso position
        GEO_ANIMATED_PART(LAYER_OPAQUE, 0, 0, 0, omm_peach_normal_torso_gfx),
        GEO_OPEN_NODE(),
            GEO_ASM(0, geo_move_mario_part_from_parent),
            GEO_ASM(0, geo_mario_tilt_torso),
            GEO_ROTATION_NODE(LAYER_OPAQUE, 0, 0, 0),
            GEO_OPEN_NODE(),
                GEO_BRANCH(1, omm_geo_peach_axes),
                GEO_ANIMATED_PART(LAYER_ALPHA, 29, 0, 0, omm_peach_normal_chest_gfx),
                GEO_OPEN_NODE(),
                    GEO_PREPROCESS_PEACH_HEAD_ROT, // Compute Peach's head rotation
                    GEO_ANIMATED_PART(LAYER_OPAQUE, 101, 0, 0, NULL),
                    GEO_OPEN_NODE(),
                        GEO_ASM(0, geo_mario_head_rotation),
                        GEO_ROTATION_NODE(LAYER_OPAQUE, 0, 0, 0),
                        GEO_OPEN_NODE(),
                            GEO_BRANCH(1, omm_geo_peach_normal_head),
                            GEO_BRANCH(1, omm_geo_peach_normal_cap_on_off),
                            GEO_BRANCH(1, omm_geo_peach_normal_eyes),
                        GEO_CLOSE_NODE(),
                    GEO_CLOSE_NODE(),
                    GEO_BRANCH(1, omm_geo_peach_normal_left_arm),
                    GEO_BRANCH(1, omm_geo_peach_normal_right_arm),
                    GEO_BRANCH(1, omm_geo_peach_normal_wings),
                GEO_CLOSE_NODE(),
            GEO_CLOSE_NODE(),
            GEO_BRANCH(1, omm_geo_peach_normal_legs),
            GEO_BRANCH(1, omm_geo_peach_normal_dress),
            GEO_DISPLAY_LIST(LAYER_OPAQUE, omm_peach_revert_gfx),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

//
// Vanish
//

static const GeoLayout omm_geo_peach_vanish_head[] = {
    GEO_OPEN_NODE(),
        GEO_DISPLAY_LIST(LAYER_TRANSPARENT, omm_peach_normal_head_gfx),
        GEO_OPEN_NODE(),
            GEO_PREPROCESS_PEACH_HAIR_ROT,
            GEO_ROTATION_NODE(LAYER_TRANSPARENT, 0, 0, 0),
            GEO_OPEN_NODE(),
                GEO_DISPLAY_LIST(LAYER_TRANSPARENT, omm_peach_normal_hair_gfx),
            GEO_CLOSE_NODE(),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_vanish_cap_on_off[] = {
    GEO_SWITCH_CASE(0, geo_switch_mario_cap_on_off),
    GEO_OPEN_NODE(),
        GEO_OPEN_NODE(),
            GEO_TRANSLATE_NODE(LAYER_TRANSPARENT, 145, -11, 0),
            GEO_OPEN_NODE(),
                GEO_PREPROCESS_PEACH_CROWN_TIARA,
                GEO_DISPLAY_LIST(LAYER_TRANSPARENT, omm_peach_normal_crown_gfx),
                GEO_DISPLAY_LIST(LAYER_TRANSPARENT, omm_peach_normal_tiara_gfx),
            GEO_CLOSE_NODE(),
        GEO_CLOSE_NODE(),
        GEO_OPEN_NODE(),
            GEO_DISPLAY_LIST(LAYER_TRANSPARENT, NULL),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_vanish_eyes[] = {
    GEO_SWITCH_CASE(0, geo_switch_mario_eyes),
    GEO_OPEN_NODE(),
        GEO_DISPLAY_LIST(LAYER_TRANSPARENT, omm_peach_normal_face_open_gfx),
        GEO_DISPLAY_LIST(LAYER_TRANSPARENT, omm_peach_normal_face_half_gfx),
        GEO_DISPLAY_LIST(LAYER_TRANSPARENT, omm_peach_normal_face_close_gfx),
        GEO_DISPLAY_LIST(LAYER_TRANSPARENT, omm_peach_normal_face_joy_gfx),
        GEO_DISPLAY_LIST(LAYER_TRANSPARENT, omm_peach_normal_face_rage_gfx),
        GEO_DISPLAY_LIST(LAYER_TRANSPARENT, omm_peach_normal_face_gloom_gfx),
        GEO_DISPLAY_LIST(LAYER_TRANSPARENT, omm_peach_normal_face_yeah_gfx),
        GEO_DISPLAY_LIST(LAYER_TRANSPARENT, omm_peach_normal_face_hurt_gfx),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_vanish_left_arm[] = {
    GEO_ANIMATED_PART(LAYER_TRANSPARENT, 40, -7, 47, NULL),
    GEO_OPEN_NODE(),
        GEO_ANIMATED_PART(LAYER_TRANSPARENT, 0, 0, 0, omm_peach_normal_arm1_left_gfx),
        GEO_OPEN_NODE(),
            GEO_ANIMATED_PART(LAYER_TRANSPARENT, 88, 0, -1, omm_peach_normal_arm2_left_gfx),
            GEO_OPEN_NODE(),
                GEO_SWITCH_CASE(1, geo_switch_mario_hand),
                GEO_OPEN_NODE(),
                    GEO_ANIMATED_PART(LAYER_TRANSPARENT, 82, 0, 0, omm_peach_normal_fist_left_gfx),
                    GEO_ANIMATED_PART(LAYER_TRANSPARENT, 82, 0, 0, omm_peach_normal_hand_left_gfx),
                    GEO_ANIMATED_PART(LAYER_TRANSPARENT, 82, 0, 0, omm_peach_normal_fist_left_gfx),
                    GEO_ANIMATED_PART(LAYER_TRANSPARENT, 82, 0, 0, omm_peach_normal_fist_left_gfx),
                    GEO_ANIMATED_PART(LAYER_TRANSPARENT, 82, 0, 0, omm_peach_normal_fist_left_gfx),
                GEO_CLOSE_NODE(),
            GEO_CLOSE_NODE(),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_vanish_right_arm[] = {
    GEO_ANIMATED_PART(LAYER_TRANSPARENT, 40, -7, -47, NULL),
    GEO_OPEN_NODE(),
        GEO_ANIMATED_PART(LAYER_TRANSPARENT, 0, 0, 0, omm_peach_normal_arm1_right_gfx),
        GEO_OPEN_NODE(),
            GEO_ANIMATED_PART(LAYER_TRANSPARENT, 88, 0, 1, omm_peach_normal_arm2_right_gfx),
            GEO_OPEN_NODE(),
                GEO_HELD_OBJECT(0, 82, 0, 0, geo_switch_mario_hand_grab_pos),
                GEO_SWITCH_CASE(0, geo_switch_mario_hand),
                GEO_OPEN_NODE(),
                    GEO_ANIMATED_PART(LAYER_TRANSPARENT, 82, 0, 0, NULL),
                    GEO_OPEN_NODE(),
                        GEO_PREPROCESS_PEACH_HAND_ROT,
                        GEO_ROTATION_NODE_WITH_DL(LAYER_TRANSPARENT, 0, 0, 0, omm_peach_normal_fist_right_gfx),
                    GEO_CLOSE_NODE(),
                    GEO_ANIMATED_PART(LAYER_TRANSPARENT, 82, 0, 0, NULL),
                    GEO_OPEN_NODE(),
                        GEO_PREPROCESS_PEACH_HAND_ROT,
                        GEO_ROTATION_NODE_WITH_DL(LAYER_TRANSPARENT, 0, 0, 0, omm_peach_normal_hand_right_gfx),
                    GEO_CLOSE_NODE(),
                    GEO_ANIMATED_PART(LAYER_TRANSPARENT, 82, 0, 0, NULL),
                    GEO_OPEN_NODE(),
                        GEO_PREPROCESS_PEACH_HAND_ROT,
                        GEO_ROTATION_NODE_WITH_DL(LAYER_TRANSPARENT, 0, 0, 0, omm_peach_normal_peace_right_gfx),
                    GEO_CLOSE_NODE(),
                    GEO_ANIMATED_PART(LAYER_TRANSPARENT, 82, 0, 0, NULL),
                    GEO_OPEN_NODE(),
                        GEO_PREPROCESS_PEACH_HAND_ROT,
                        GEO_ROTATION_NODE_WITH_DL(LAYER_TRANSPARENT, 0, 0, 0, omm_peach_normal_fist_right_crown_gfx),
                    GEO_CLOSE_NODE(),
                    GEO_ANIMATED_PART(LAYER_TRANSPARENT, 82, 0, 0, NULL),
                    GEO_OPEN_NODE(),
                        GEO_PREPROCESS_PEACH_HAND_ROT,
                        GEO_ROTATION_NODE_WITH_DL(LAYER_TRANSPARENT, 0, 0, 0, omm_peach_normal_fist_right_tiara_gfx),
                    GEO_CLOSE_NODE(),
                GEO_CLOSE_NODE(),
            GEO_CLOSE_NODE(),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_vanish_wings[] = {
    GEO_SCALE(LAYER_TRANSPARENT, 0x18000),
    GEO_OPEN_NODE(),
        GEO_SWITCH_CASE(0, geo_switch_mario_cap_on_off),
        GEO_OPEN_NODE(),
        GEO_CLOSE_NODE(),
        GEO_TRANSLATE_ROTATE(LAYER_TRANSPARENT, -48, -90, -40, 22, 0, -135),
        GEO_OPEN_NODE(),
            GEO_ASM(0, geo_mario_rotate_wing_cap_wings),
            GEO_ROTATION_NODE(LAYER_TRANSPARENT, 0, 0, 0),
            GEO_OPEN_NODE(),
                GEO_DISPLAY_LIST(LAYER_TRANSPARENT, omm_peach_normal_wing_gfx),
            GEO_CLOSE_NODE(),
        GEO_CLOSE_NODE(),
        GEO_TRANSLATE_ROTATE(LAYER_TRANSPARENT, -48, -90, 40, -22, 0, -135),
        GEO_OPEN_NODE(),
            GEO_ASM(1, geo_mario_rotate_wing_cap_wings),
            GEO_ROTATION_NODE(LAYER_TRANSPARENT, 0, 0, 0),
            GEO_OPEN_NODE(),
                GEO_DISPLAY_LIST(LAYER_TRANSPARENT, omm_peach_normal_wing_gfx),
            GEO_CLOSE_NODE(),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_vanish_left_leg[] = {
    GEO_ANIMATED_PART(LAYER_TRANSPARENT, -103, -8, 32, NULL),
    GEO_OPEN_NODE(),
        GEO_PREPROCESS_PEACH_LEFT_LEG_POS,
        GEO_ANIMATED_PART(LAYER_TRANSPARENT, 0, 0, 0, omm_peach_normal_leg1_left_gfx),
        GEO_OPEN_NODE(),
            GEO_ANIMATED_PART(LAYER_TRANSPARENT, 68, -4, 0, omm_peach_normal_leg2_left_gfx),
            GEO_OPEN_NODE(),
                GEO_PREPROCESS_PEACH_LEFT_FOOT_POS,
                GEO_ANIMATED_PART(LAYER_TRANSPARENT, 90, 1, 0, NULL),
                GEO_OPEN_NODE(),
                    GEO_ROTATION_NODE(LAYER_TRANSPARENT, 0, 0, -20),
                    GEO_OPEN_NODE(),
                        GEO_SCALE_WITH_DL(LAYER_TRANSPARENT, 0x14000, omm_peach_normal_foot_left_gfx),
                    GEO_CLOSE_NODE(),
                GEO_CLOSE_NODE(),
            GEO_CLOSE_NODE(),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_vanish_left_leg_hidden[] = {
    GEO_ANIMATED_PART(LAYER_TRANSPARENT, -103, -8, 32, NULL),
    GEO_OPEN_NODE(),
        GEO_PREPROCESS_PEACH_LEFT_LEG_POS,
        GEO_ANIMATED_PART(LAYER_TRANSPARENT, 0, 0, 0, NULL),
        GEO_OPEN_NODE(),
            GEO_ANIMATED_PART(LAYER_TRANSPARENT, 68, -4, 0, NULL),
            GEO_OPEN_NODE(),
                GEO_PREPROCESS_PEACH_LEFT_FOOT_POS,
                GEO_ANIMATED_PART(LAYER_TRANSPARENT, 90, 1, 0, NULL),
            GEO_CLOSE_NODE(),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_vanish_right_leg[] = {
    GEO_ANIMATED_PART(LAYER_TRANSPARENT, -103, -8, -32, NULL),
    GEO_OPEN_NODE(),
        GEO_PREPROCESS_PEACH_RIGHT_LEG_POS,
        GEO_ANIMATED_PART(LAYER_TRANSPARENT, 0, 0, 0, omm_peach_normal_leg1_right_gfx),
        GEO_OPEN_NODE(),
            GEO_ANIMATED_PART(LAYER_TRANSPARENT, 68, -4, 0, omm_peach_normal_leg2_right_gfx),
            GEO_OPEN_NODE(),
                GEO_PREPROCESS_PEACH_RIGHT_FOOT_POS,
                GEO_ANIMATED_PART(LAYER_TRANSPARENT, 90, 1, 0, NULL),
                GEO_OPEN_NODE(),
                    GEO_ROTATION_NODE(LAYER_TRANSPARENT, 0, 0, -20),
                    GEO_OPEN_NODE(),
                        GEO_SCALE_WITH_DL(LAYER_TRANSPARENT, 0x14000, omm_peach_normal_foot_right_gfx),
                    GEO_CLOSE_NODE(),
                GEO_CLOSE_NODE(),
            GEO_CLOSE_NODE(),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_vanish_right_leg_hidden[] = {
    GEO_ANIMATED_PART(LAYER_TRANSPARENT, -103, -8, -32, NULL),
    GEO_OPEN_NODE(),
        GEO_PREPROCESS_PEACH_RIGHT_LEG_POS,
        GEO_ANIMATED_PART(LAYER_TRANSPARENT, 0, 0, 0, NULL),
        GEO_OPEN_NODE(),
            GEO_ANIMATED_PART(LAYER_TRANSPARENT, 68, -4, 0, NULL),
            GEO_OPEN_NODE(),
                GEO_PREPROCESS_PEACH_RIGHT_FOOT_POS,
                GEO_ANIMATED_PART(LAYER_TRANSPARENT, 90, 1, 0, NULL),
            GEO_CLOSE_NODE(),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_vanish_legs[] = {
    GEO_SWITCH_CASE(4, geo_switch_anim_state),
    GEO_OPEN_NODE(),
        GEO_TRANSLATE_NODE(LAYER_TRANSPARENT, 0, 0, 0),
        GEO_OPEN_NODE(),
            GEO_BRANCH(1, omm_geo_peach_vanish_left_leg),
            GEO_BRANCH(1, omm_geo_peach_vanish_right_leg),
        GEO_CLOSE_NODE(),
        GEO_TRANSLATE_NODE(LAYER_TRANSPARENT, 0, 0, 0),
        GEO_OPEN_NODE(),
            GEO_BRANCH(1, omm_geo_peach_vanish_left_leg),
            GEO_BRANCH(1, omm_geo_peach_vanish_right_leg_hidden),
        GEO_CLOSE_NODE(),
        GEO_TRANSLATE_NODE(LAYER_TRANSPARENT, 0, 0, 0),
        GEO_OPEN_NODE(),
            GEO_BRANCH(1, omm_geo_peach_vanish_left_leg_hidden),
            GEO_BRANCH(1, omm_geo_peach_vanish_right_leg),
        GEO_CLOSE_NODE(),
        GEO_TRANSLATE_NODE(LAYER_TRANSPARENT, 0, 0, 0),
        GEO_OPEN_NODE(),
            GEO_BRANCH(1, omm_geo_peach_vanish_left_leg_hidden),
            GEO_BRANCH(1, omm_geo_peach_vanish_right_leg_hidden),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_vanish_dress[] = {
    GEO_TRANSLATE_NODE(LAYER_TRANSPARENT, -15, 0, 0),
    GEO_OPEN_NODE(),
        GEO_PREPROCESS_PEACH_HIPS_ROT_AND_LEGS,
        GEO_ROTATION_NODE(LAYER_TRANSPARENT, 0, 0, 0),
        GEO_OPEN_NODE(),
            GEO_DISPLAY_LIST(LAYER_TRANSPARENT, omm_peach_normal_hips_gfx),
            GEO_OPEN_NODE(),
                GEO_TRANSLATE_NODE(LAYER_TRANSPARENT, -96, -4, 0),
                GEO_OPEN_NODE(),
                    GEO_PREPROCESS_PEACH_DRESS_ROT,
                    GEO_ROTATION_NODE(LAYER_TRANSPARENT, 0, 0, 0),
                    GEO_OPEN_NODE(),
                        GEO_DISPLAY_LIST(LAYER_TRANSPARENT, omm_peach_normal_dress_gfx),
                    GEO_CLOSE_NODE(),
                GEO_CLOSE_NODE(),
            GEO_CLOSE_NODE(),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_vanish[] = {
    GEO_ANIMATED_PART(LAYER_TRANSPARENT, 0, 140, 0, NULL),
    GEO_OPEN_NODE(),
        GEO_PREPROCESS_PEACH_TORSO_POS,
        GEO_ANIMATED_PART(LAYER_TRANSPARENT, 0, 0, 0, omm_peach_normal_torso_gfx),
        GEO_OPEN_NODE(),
            GEO_ASM(0, geo_move_mario_part_from_parent),
            GEO_ASM(0, geo_mario_tilt_torso),
            GEO_ROTATION_NODE(LAYER_TRANSPARENT, 0, 0, 0),
            GEO_OPEN_NODE(),
                GEO_BRANCH(1, omm_geo_peach_axes),
                GEO_ANIMATED_PART(LAYER_TRANSPARENT, 29, 0, 0, omm_peach_normal_chest_gfx),
                GEO_OPEN_NODE(),
                    GEO_PREPROCESS_PEACH_HEAD_ROT,
                    GEO_ANIMATED_PART(LAYER_TRANSPARENT, 101, 0, 0, NULL),
                    GEO_OPEN_NODE(),
                        GEO_ASM(0, geo_mario_head_rotation),
                        GEO_ROTATION_NODE(LAYER_TRANSPARENT, 0, 0, 0),
                        GEO_OPEN_NODE(),
                            GEO_BRANCH(1, omm_geo_peach_vanish_head),
                            GEO_BRANCH(1, omm_geo_peach_vanish_cap_on_off),
                            GEO_BRANCH(1, omm_geo_peach_vanish_eyes),
                        GEO_CLOSE_NODE(),
                    GEO_CLOSE_NODE(),
                    GEO_BRANCH(1, omm_geo_peach_vanish_left_arm),
                    GEO_BRANCH(1, omm_geo_peach_vanish_right_arm),
                    GEO_BRANCH(1, omm_geo_peach_vanish_wings),
                GEO_CLOSE_NODE(),
            GEO_CLOSE_NODE(),
            GEO_BRANCH(1, omm_geo_peach_vanish_legs),
            GEO_BRANCH(1, omm_geo_peach_vanish_dress),
            GEO_DISPLAY_LIST(LAYER_TRANSPARENT, omm_peach_revert_gfx),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

//
// Metal
//

static const GeoLayout omm_geo_peach_metal_head[] = {
    GEO_OPEN_NODE(),
        GEO_DISPLAY_LIST(LAYER_OPAQUE, omm_peach_metal_head_gfx),
        GEO_OPEN_NODE(),
            GEO_PREPROCESS_PEACH_HAIR_ROT,
            GEO_ROTATION_NODE(LAYER_OPAQUE, 0, 0, 0),
            GEO_OPEN_NODE(),
                GEO_DISPLAY_LIST(LAYER_OPAQUE, omm_peach_metal_hair_gfx),
            GEO_CLOSE_NODE(),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_metal_cap_on_off[] = {
    GEO_SWITCH_CASE(0, geo_switch_mario_cap_on_off),
    GEO_OPEN_NODE(),
        GEO_OPEN_NODE(),
            GEO_TRANSLATE_NODE(LAYER_OPAQUE, 145, -11, 0),
            GEO_OPEN_NODE(),
                GEO_PREPROCESS_PEACH_CROWN_TIARA,
                GEO_DISPLAY_LIST(LAYER_OPAQUE, omm_peach_metal_crown_gfx),
                GEO_DISPLAY_LIST(LAYER_OPAQUE, omm_peach_metal_tiara_gfx),
            GEO_CLOSE_NODE(),
        GEO_CLOSE_NODE(),
        GEO_OPEN_NODE(),
            GEO_DISPLAY_LIST(LAYER_OPAQUE, NULL),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_metal_eyes[] = {
    GEO_SWITCH_CASE(0, geo_switch_mario_eyes),
    GEO_OPEN_NODE(),
        GEO_DISPLAY_LIST(LAYER_OPAQUE, omm_peach_metal_face_gfx),
        GEO_DISPLAY_LIST(LAYER_OPAQUE, omm_peach_metal_face_gfx),
        GEO_DISPLAY_LIST(LAYER_OPAQUE, omm_peach_metal_face_gfx),
        GEO_DISPLAY_LIST(LAYER_OPAQUE, omm_peach_metal_face_gfx),
        GEO_DISPLAY_LIST(LAYER_OPAQUE, omm_peach_metal_face_gfx),
        GEO_DISPLAY_LIST(LAYER_OPAQUE, omm_peach_metal_face_gfx),
        GEO_DISPLAY_LIST(LAYER_OPAQUE, omm_peach_metal_face_gfx),
        GEO_DISPLAY_LIST(LAYER_OPAQUE, omm_peach_metal_face_gfx),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_metal_left_arm[] = {
    GEO_ANIMATED_PART(LAYER_OPAQUE, 40, -7, 47, NULL),
    GEO_OPEN_NODE(),
        GEO_ANIMATED_PART(LAYER_OPAQUE, 0, 0, 0, omm_peach_metal_arm1_left_gfx),
        GEO_OPEN_NODE(),
            GEO_ANIMATED_PART(LAYER_OPAQUE, 88, 0, -1, omm_peach_metal_arm2_left_gfx),
            GEO_OPEN_NODE(),
                GEO_SWITCH_CASE(1, geo_switch_mario_hand),
                GEO_OPEN_NODE(),
                    GEO_ANIMATED_PART(LAYER_OPAQUE, 82, 0, 0, omm_peach_metal_fist_left_gfx),
                    GEO_ANIMATED_PART(LAYER_OPAQUE, 82, 0, 0, omm_peach_metal_hand_left_gfx),
                    GEO_ANIMATED_PART(LAYER_OPAQUE, 82, 0, 0, omm_peach_metal_fist_left_gfx),
                    GEO_ANIMATED_PART(LAYER_OPAQUE, 82, 0, 0, omm_peach_metal_fist_left_gfx),
                    GEO_ANIMATED_PART(LAYER_OPAQUE, 82, 0, 0, omm_peach_metal_fist_left_gfx),
                GEO_CLOSE_NODE(),
            GEO_CLOSE_NODE(),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_metal_right_arm[] = {
    GEO_ANIMATED_PART(LAYER_OPAQUE, 40, -7, -47, NULL),
    GEO_OPEN_NODE(),
        GEO_ANIMATED_PART(LAYER_OPAQUE, 0, 0, 0, omm_peach_metal_arm1_right_gfx),
        GEO_OPEN_NODE(),
            GEO_ANIMATED_PART(LAYER_OPAQUE, 88, 0, 1, omm_peach_metal_arm2_right_gfx),
            GEO_OPEN_NODE(),
                GEO_HELD_OBJECT(0, 82, 0, 0, geo_switch_mario_hand_grab_pos),
                GEO_SWITCH_CASE(0, geo_switch_mario_hand),
                GEO_OPEN_NODE(),
                    GEO_ANIMATED_PART(LAYER_OPAQUE, 82, 0, 0, NULL),
                    GEO_OPEN_NODE(),
                        GEO_PREPROCESS_PEACH_HAND_ROT,
                        GEO_ROTATION_NODE_WITH_DL(LAYER_OPAQUE, 0, 0, 0, omm_peach_metal_fist_right_gfx),
                    GEO_CLOSE_NODE(),
                    GEO_ANIMATED_PART(LAYER_OPAQUE, 82, 0, 0, NULL),
                    GEO_OPEN_NODE(),
                        GEO_PREPROCESS_PEACH_HAND_ROT,
                        GEO_ROTATION_NODE_WITH_DL(LAYER_OPAQUE, 0, 0, 0, omm_peach_metal_hand_right_gfx),
                    GEO_CLOSE_NODE(),
                    GEO_ANIMATED_PART(LAYER_OPAQUE, 82, 0, 0, NULL),
                    GEO_OPEN_NODE(),
                        GEO_PREPROCESS_PEACH_HAND_ROT,
                        GEO_ROTATION_NODE_WITH_DL(LAYER_OPAQUE, 0, 0, 0, omm_peach_metal_peace_right_gfx),
                    GEO_CLOSE_NODE(),
                    GEO_ANIMATED_PART(LAYER_OPAQUE, 82, 0, 0, NULL),
                    GEO_OPEN_NODE(),
                        GEO_PREPROCESS_PEACH_HAND_ROT,
                        GEO_ROTATION_NODE_WITH_DL(LAYER_OPAQUE, 0, 0, 0, omm_peach_metal_fist_right_crown_gfx),
                    GEO_CLOSE_NODE(),
                    GEO_ANIMATED_PART(LAYER_OPAQUE, 82, 0, 0, NULL),
                    GEO_OPEN_NODE(),
                        GEO_PREPROCESS_PEACH_HAND_ROT,
                        GEO_ROTATION_NODE_WITH_DL(LAYER_OPAQUE, 0, 0, 0, omm_peach_metal_fist_right_tiara_gfx),
                    GEO_CLOSE_NODE(),
                GEO_CLOSE_NODE(),
            GEO_CLOSE_NODE(),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_metal_wings[] = {
    GEO_SCALE(LAYER_OPAQUE, 0x18000),
    GEO_OPEN_NODE(),
        GEO_SWITCH_CASE(0, geo_switch_mario_cap_on_off),
        GEO_OPEN_NODE(),
        GEO_CLOSE_NODE(),
        GEO_TRANSLATE_ROTATE(LAYER_OPAQUE, -48, -90, -40, 22, 0, -135),
        GEO_OPEN_NODE(),
            GEO_ASM(0, geo_mario_rotate_wing_cap_wings),
            GEO_ROTATION_NODE(LAYER_OPAQUE, 0, 0, 0),
            GEO_OPEN_NODE(),
                GEO_DISPLAY_LIST(LAYER_ALPHA, omm_peach_normal_wing_gfx),
            GEO_CLOSE_NODE(),
        GEO_CLOSE_NODE(),
        GEO_TRANSLATE_ROTATE(LAYER_OPAQUE, -48, -90, 40, -22, 0, -135),
        GEO_OPEN_NODE(),
            GEO_ASM(1, geo_mario_rotate_wing_cap_wings),
            GEO_ROTATION_NODE(LAYER_OPAQUE, 0, 0, 0),
            GEO_OPEN_NODE(),
                GEO_DISPLAY_LIST(LAYER_ALPHA, omm_peach_normal_wing_gfx),
            GEO_CLOSE_NODE(),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_metal_left_leg[] = {
    GEO_ANIMATED_PART(LAYER_OPAQUE, -103, -8, 32, NULL),
    GEO_OPEN_NODE(),
        GEO_PREPROCESS_PEACH_LEFT_LEG_POS,
        GEO_ANIMATED_PART(LAYER_OPAQUE, 0, 0, 0, omm_peach_metal_leg1_left_gfx),
        GEO_OPEN_NODE(),
            GEO_ANIMATED_PART(LAYER_OPAQUE, 68, -4, 0, omm_peach_metal_leg2_left_gfx),
            GEO_OPEN_NODE(),
                GEO_PREPROCESS_PEACH_LEFT_FOOT_POS,
                GEO_ANIMATED_PART(LAYER_OPAQUE, 90, 1, 0, NULL),
                GEO_OPEN_NODE(),
                    GEO_ROTATION_NODE(LAYER_OPAQUE, 0, 0, -20),
                    GEO_OPEN_NODE(),
                        GEO_SCALE_WITH_DL(LAYER_OPAQUE, 0x14000, omm_peach_metal_foot_left_gfx),
                    GEO_CLOSE_NODE(),
                GEO_CLOSE_NODE(),
            GEO_CLOSE_NODE(),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_metal_left_leg_hidden[] = {
    GEO_ANIMATED_PART(LAYER_OPAQUE, -103, -8, 32, NULL),
    GEO_OPEN_NODE(),
        GEO_PREPROCESS_PEACH_LEFT_LEG_POS,
        GEO_ANIMATED_PART(LAYER_OPAQUE, 0, 0, 0, NULL),
        GEO_OPEN_NODE(),
            GEO_ANIMATED_PART(LAYER_OPAQUE, 68, -4, 0, NULL),
            GEO_OPEN_NODE(),
                GEO_PREPROCESS_PEACH_LEFT_FOOT_POS,
                GEO_ANIMATED_PART(LAYER_OPAQUE, 90, 1, 0, NULL),
            GEO_CLOSE_NODE(),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_metal_right_leg[] = {
    GEO_ANIMATED_PART(LAYER_OPAQUE, -103, -8, -32, NULL),
    GEO_OPEN_NODE(),
        GEO_PREPROCESS_PEACH_RIGHT_LEG_POS,
        GEO_ANIMATED_PART(LAYER_OPAQUE, 0, 0, 0, omm_peach_metal_leg1_right_gfx),
        GEO_OPEN_NODE(),
            GEO_ANIMATED_PART(LAYER_OPAQUE, 68, -4, 0, omm_peach_metal_leg2_right_gfx),
            GEO_OPEN_NODE(),
                GEO_PREPROCESS_PEACH_RIGHT_FOOT_POS,
                GEO_ANIMATED_PART(LAYER_OPAQUE, 90, 1, 0, NULL),
                GEO_OPEN_NODE(),
                    GEO_ROTATION_NODE(LAYER_OPAQUE, 0, 0, -20),
                    GEO_OPEN_NODE(),
                        GEO_SCALE_WITH_DL(LAYER_OPAQUE, 0x14000, omm_peach_metal_foot_right_gfx),
                    GEO_CLOSE_NODE(),
                GEO_CLOSE_NODE(),
            GEO_CLOSE_NODE(),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_metal_right_leg_hidden[] = {
    GEO_ANIMATED_PART(LAYER_OPAQUE, -103, -8, -32, NULL),
    GEO_OPEN_NODE(),
        GEO_PREPROCESS_PEACH_RIGHT_LEG_POS,
        GEO_ANIMATED_PART(LAYER_OPAQUE, 0, 0, 0, NULL),
        GEO_OPEN_NODE(),
            GEO_ANIMATED_PART(LAYER_OPAQUE, 68, -4, 0, NULL),
            GEO_OPEN_NODE(),
                GEO_PREPROCESS_PEACH_RIGHT_FOOT_POS,
                GEO_ANIMATED_PART(LAYER_OPAQUE, 90, 1, 0, NULL),
            GEO_CLOSE_NODE(),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_metal_legs[] = {
    GEO_SWITCH_CASE(4, geo_switch_anim_state),
    GEO_OPEN_NODE(),
        GEO_TRANSLATE_NODE(LAYER_OPAQUE, 0, 0, 0),
        GEO_OPEN_NODE(),
            GEO_BRANCH(1, omm_geo_peach_metal_left_leg),
            GEO_BRANCH(1, omm_geo_peach_metal_right_leg),
        GEO_CLOSE_NODE(),
        GEO_TRANSLATE_NODE(LAYER_OPAQUE, 0, 0, 0),
        GEO_OPEN_NODE(),
            GEO_BRANCH(1, omm_geo_peach_metal_left_leg),
            GEO_BRANCH(1, omm_geo_peach_metal_right_leg_hidden),
        GEO_CLOSE_NODE(),
        GEO_TRANSLATE_NODE(LAYER_OPAQUE, 0, 0, 0),
        GEO_OPEN_NODE(),
            GEO_BRANCH(1, omm_geo_peach_metal_left_leg_hidden),
            GEO_BRANCH(1, omm_geo_peach_metal_right_leg),
        GEO_CLOSE_NODE(),
        GEO_TRANSLATE_NODE(LAYER_OPAQUE, 0, 0, 0),
        GEO_OPEN_NODE(),
            GEO_BRANCH(1, omm_geo_peach_metal_left_leg_hidden),
            GEO_BRANCH(1, omm_geo_peach_metal_right_leg_hidden),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_metal_dress[] = {
    GEO_TRANSLATE_NODE(LAYER_OPAQUE, -15, 0, 0),
    GEO_OPEN_NODE(),
        GEO_PREPROCESS_PEACH_HIPS_ROT_AND_LEGS,
        GEO_ROTATION_NODE(LAYER_OPAQUE, 0, 0, 0),
        GEO_OPEN_NODE(),
            GEO_DISPLAY_LIST(LAYER_OPAQUE, omm_peach_metal_hips_gfx),
            GEO_OPEN_NODE(),
                GEO_TRANSLATE_NODE(LAYER_OPAQUE, -96, -4, 0),
                GEO_OPEN_NODE(),
                    GEO_PREPROCESS_PEACH_DRESS_ROT,
                    GEO_ROTATION_NODE(LAYER_OPAQUE, 0, 0, 0),
                    GEO_OPEN_NODE(),
                        GEO_DISPLAY_LIST(LAYER_OPAQUE, omm_peach_metal_dress_gfx),
                    GEO_CLOSE_NODE(),
                GEO_CLOSE_NODE(),
            GEO_CLOSE_NODE(),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_metal[] = {
    GEO_ANIMATED_PART(LAYER_OPAQUE, 0, 140, 0, NULL),
    GEO_OPEN_NODE(),
        GEO_PREPROCESS_PEACH_TORSO_POS,
        GEO_ANIMATED_PART(LAYER_OPAQUE, 0, 0, 0, omm_peach_metal_torso_gfx),
        GEO_OPEN_NODE(),
            GEO_ASM(0, geo_move_mario_part_from_parent),
            GEO_ASM(0, geo_mario_tilt_torso),
            GEO_ROTATION_NODE(LAYER_OPAQUE, 0, 0, 0),
            GEO_OPEN_NODE(),
                GEO_BRANCH(1, omm_geo_peach_axes),
                GEO_ANIMATED_PART(LAYER_OPAQUE, 29, 0, 0, omm_peach_metal_chest_gfx),
                GEO_OPEN_NODE(),
                    GEO_PREPROCESS_PEACH_HEAD_ROT,
                    GEO_ANIMATED_PART(LAYER_OPAQUE, 101, 0, 0, NULL),
                    GEO_OPEN_NODE(),
                        GEO_ASM(0, geo_mario_head_rotation),
                        GEO_ROTATION_NODE(LAYER_OPAQUE, 0, 0, 0),
                        GEO_OPEN_NODE(),
                            GEO_BRANCH(1, omm_geo_peach_metal_head),
                            GEO_BRANCH(1, omm_geo_peach_metal_cap_on_off),
                            GEO_BRANCH(1, omm_geo_peach_metal_eyes),
                        GEO_CLOSE_NODE(),
                    GEO_CLOSE_NODE(),
                    GEO_BRANCH(1, omm_geo_peach_metal_left_arm),
                    GEO_BRANCH(1, omm_geo_peach_metal_right_arm),
                    GEO_BRANCH(1, omm_geo_peach_metal_wings),
                GEO_CLOSE_NODE(),
            GEO_CLOSE_NODE(),
            GEO_BRANCH(1, omm_geo_peach_metal_legs),
            GEO_BRANCH(1, omm_geo_peach_metal_dress),
            GEO_DISPLAY_LIST(LAYER_OPAQUE, omm_peach_revert_gfx),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

//
// Metal Vanish
//

static const GeoLayout omm_geo_peach_metal_vanish_head[] = {
    GEO_OPEN_NODE(),
        GEO_DISPLAY_LIST(LAYER_TRANSPARENT, omm_peach_metal_head_gfx),
        GEO_OPEN_NODE(),
            GEO_PREPROCESS_PEACH_HAIR_ROT,
            GEO_ROTATION_NODE(LAYER_TRANSPARENT, 0, 0, 0),
            GEO_OPEN_NODE(),
                GEO_DISPLAY_LIST(LAYER_TRANSPARENT, omm_peach_metal_hair_gfx),
            GEO_CLOSE_NODE(),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_metal_vanish_cap_on_off[] = {
    GEO_SWITCH_CASE(0, geo_switch_mario_cap_on_off),
    GEO_OPEN_NODE(),
        GEO_OPEN_NODE(),
            GEO_TRANSLATE_NODE(LAYER_TRANSPARENT, 145, -11, 0),
            GEO_OPEN_NODE(),
                GEO_PREPROCESS_PEACH_CROWN_TIARA,
                GEO_DISPLAY_LIST(LAYER_TRANSPARENT, omm_peach_metal_crown_gfx),
                GEO_DISPLAY_LIST(LAYER_TRANSPARENT, omm_peach_metal_tiara_gfx),
            GEO_CLOSE_NODE(),
        GEO_CLOSE_NODE(),
        GEO_OPEN_NODE(),
            GEO_DISPLAY_LIST(LAYER_TRANSPARENT, NULL),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_metal_vanish_eyes[] = {
    GEO_SWITCH_CASE(0, geo_switch_mario_eyes),
    GEO_OPEN_NODE(),
        GEO_DISPLAY_LIST(LAYER_TRANSPARENT, omm_peach_metal_face_gfx),
        GEO_DISPLAY_LIST(LAYER_TRANSPARENT, omm_peach_metal_face_gfx),
        GEO_DISPLAY_LIST(LAYER_TRANSPARENT, omm_peach_metal_face_gfx),
        GEO_DISPLAY_LIST(LAYER_TRANSPARENT, omm_peach_metal_face_gfx),
        GEO_DISPLAY_LIST(LAYER_TRANSPARENT, omm_peach_metal_face_gfx),
        GEO_DISPLAY_LIST(LAYER_TRANSPARENT, omm_peach_metal_face_gfx),
        GEO_DISPLAY_LIST(LAYER_TRANSPARENT, omm_peach_metal_face_gfx),
        GEO_DISPLAY_LIST(LAYER_TRANSPARENT, omm_peach_metal_face_gfx),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_metal_vanish_left_arm[] = {
    GEO_ANIMATED_PART(LAYER_TRANSPARENT, 40, -7, 47, NULL),
    GEO_OPEN_NODE(),
        GEO_ANIMATED_PART(LAYER_TRANSPARENT, 0, 0, 0, omm_peach_metal_arm1_left_gfx),
        GEO_OPEN_NODE(),
            GEO_ANIMATED_PART(LAYER_TRANSPARENT, 88, 0, -1, omm_peach_metal_arm2_left_gfx),
            GEO_OPEN_NODE(),
                GEO_SWITCH_CASE(1, geo_switch_mario_hand),
                GEO_OPEN_NODE(),
                    GEO_ANIMATED_PART(LAYER_TRANSPARENT, 82, 0, 0, omm_peach_metal_fist_left_gfx),
                    GEO_ANIMATED_PART(LAYER_TRANSPARENT, 82, 0, 0, omm_peach_metal_hand_left_gfx),
                    GEO_ANIMATED_PART(LAYER_TRANSPARENT, 82, 0, 0, omm_peach_metal_fist_left_gfx),
                    GEO_ANIMATED_PART(LAYER_TRANSPARENT, 82, 0, 0, omm_peach_metal_fist_left_gfx),
                    GEO_ANIMATED_PART(LAYER_TRANSPARENT, 82, 0, 0, omm_peach_metal_fist_left_gfx),
                GEO_CLOSE_NODE(),
            GEO_CLOSE_NODE(),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_metal_vanish_right_arm[] = {
    GEO_ANIMATED_PART(LAYER_TRANSPARENT, 40, -7, -47, NULL),
    GEO_OPEN_NODE(),
        GEO_ANIMATED_PART(LAYER_TRANSPARENT, 0, 0, 0, omm_peach_metal_arm1_right_gfx),
        GEO_OPEN_NODE(),
            GEO_ANIMATED_PART(LAYER_TRANSPARENT, 88, 0, 1, omm_peach_metal_arm2_right_gfx),
            GEO_OPEN_NODE(),
                GEO_HELD_OBJECT(0, 82, 0, 0, geo_switch_mario_hand_grab_pos),
                GEO_SWITCH_CASE(0, geo_switch_mario_hand),
                GEO_OPEN_NODE(),
                    GEO_ANIMATED_PART(LAYER_TRANSPARENT, 82, 0, 0, NULL),
                    GEO_OPEN_NODE(),
                        GEO_PREPROCESS_PEACH_HAND_ROT,
                        GEO_ROTATION_NODE_WITH_DL(LAYER_TRANSPARENT, 0, 0, 0, omm_peach_metal_fist_right_gfx),
                    GEO_CLOSE_NODE(),
                    GEO_ANIMATED_PART(LAYER_TRANSPARENT, 82, 0, 0, NULL),
                    GEO_OPEN_NODE(),
                        GEO_PREPROCESS_PEACH_HAND_ROT,
                        GEO_ROTATION_NODE_WITH_DL(LAYER_TRANSPARENT, 0, 0, 0, omm_peach_metal_hand_right_gfx),
                    GEO_CLOSE_NODE(),
                    GEO_ANIMATED_PART(LAYER_TRANSPARENT, 82, 0, 0, NULL),
                    GEO_OPEN_NODE(),
                        GEO_PREPROCESS_PEACH_HAND_ROT,
                        GEO_ROTATION_NODE_WITH_DL(LAYER_TRANSPARENT, 0, 0, 0, omm_peach_metal_peace_right_gfx),
                    GEO_CLOSE_NODE(),
                    GEO_ANIMATED_PART(LAYER_TRANSPARENT, 82, 0, 0, NULL),
                    GEO_OPEN_NODE(),
                        GEO_PREPROCESS_PEACH_HAND_ROT,
                        GEO_ROTATION_NODE_WITH_DL(LAYER_TRANSPARENT, 0, 0, 0, omm_peach_metal_fist_right_crown_gfx),
                    GEO_CLOSE_NODE(),
                    GEO_ANIMATED_PART(LAYER_TRANSPARENT, 82, 0, 0, NULL),
                    GEO_OPEN_NODE(),
                        GEO_PREPROCESS_PEACH_HAND_ROT,
                        GEO_ROTATION_NODE_WITH_DL(LAYER_TRANSPARENT, 0, 0, 0, omm_peach_metal_fist_right_tiara_gfx),
                    GEO_CLOSE_NODE(),
                GEO_CLOSE_NODE(),
            GEO_CLOSE_NODE(),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_metal_vanish_wings[] = {
    GEO_SCALE(LAYER_TRANSPARENT, 0x18000),
    GEO_OPEN_NODE(),
        GEO_SWITCH_CASE(0, geo_switch_mario_cap_on_off),
        GEO_OPEN_NODE(),
        GEO_CLOSE_NODE(),
        GEO_TRANSLATE_ROTATE(LAYER_TRANSPARENT, -48, -90, -40, 22, 0, -135),
        GEO_OPEN_NODE(),
            GEO_ASM(0, geo_mario_rotate_wing_cap_wings),
            GEO_ROTATION_NODE(LAYER_TRANSPARENT, 0, 0, 0),
            GEO_OPEN_NODE(),
                GEO_DISPLAY_LIST(LAYER_TRANSPARENT, omm_peach_normal_wing_gfx),
            GEO_CLOSE_NODE(),
        GEO_CLOSE_NODE(),
        GEO_TRANSLATE_ROTATE(LAYER_TRANSPARENT, -48, -90, 40, -22, 0, -135),
        GEO_OPEN_NODE(),
            GEO_ASM(1, geo_mario_rotate_wing_cap_wings),
            GEO_ROTATION_NODE(LAYER_TRANSPARENT, 0, 0, 0),
            GEO_OPEN_NODE(),
                GEO_DISPLAY_LIST(LAYER_TRANSPARENT, omm_peach_normal_wing_gfx),
            GEO_CLOSE_NODE(),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_metal_vanish_left_leg[] = {
    GEO_ANIMATED_PART(LAYER_TRANSPARENT, -103, -8, 32, NULL),
    GEO_OPEN_NODE(),
        GEO_PREPROCESS_PEACH_LEFT_LEG_POS,
        GEO_ANIMATED_PART(LAYER_TRANSPARENT, 0, 0, 0, omm_peach_metal_leg1_left_gfx),
        GEO_OPEN_NODE(),
            GEO_ANIMATED_PART(LAYER_TRANSPARENT, 68, -4, 0, omm_peach_metal_leg2_left_gfx),
            GEO_OPEN_NODE(),
                GEO_PREPROCESS_PEACH_LEFT_FOOT_POS,
                GEO_ANIMATED_PART(LAYER_TRANSPARENT, 90, 1, 0, NULL),
                GEO_OPEN_NODE(),
                    GEO_ROTATION_NODE(LAYER_TRANSPARENT, 0, 0, -20),
                    GEO_OPEN_NODE(),
                        GEO_SCALE_WITH_DL(LAYER_TRANSPARENT, 0x14000, omm_peach_metal_foot_left_gfx),
                    GEO_CLOSE_NODE(),
                GEO_CLOSE_NODE(),
            GEO_CLOSE_NODE(),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_metal_vanish_left_leg_hidden[] = {
    GEO_ANIMATED_PART(LAYER_TRANSPARENT, -103, -8, 32, NULL),
    GEO_OPEN_NODE(),
        GEO_PREPROCESS_PEACH_LEFT_LEG_POS,
        GEO_ANIMATED_PART(LAYER_TRANSPARENT, 0, 0, 0, NULL),
        GEO_OPEN_NODE(),
            GEO_ANIMATED_PART(LAYER_TRANSPARENT, 68, -4, 0, NULL),
            GEO_OPEN_NODE(),
                GEO_PREPROCESS_PEACH_LEFT_FOOT_POS,
                GEO_ANIMATED_PART(LAYER_TRANSPARENT, 90, 1, 0, NULL),
            GEO_CLOSE_NODE(),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_metal_vanish_right_leg[] = {
    GEO_ANIMATED_PART(LAYER_TRANSPARENT, -103, -8, -32, NULL),
    GEO_OPEN_NODE(),
        GEO_PREPROCESS_PEACH_RIGHT_LEG_POS,
        GEO_ANIMATED_PART(LAYER_TRANSPARENT, 0, 0, 0, omm_peach_metal_leg1_right_gfx),
        GEO_OPEN_NODE(),
            GEO_ANIMATED_PART(LAYER_TRANSPARENT, 68, -4, 0, omm_peach_metal_leg2_right_gfx),
            GEO_OPEN_NODE(),
                GEO_PREPROCESS_PEACH_RIGHT_FOOT_POS,
                GEO_ANIMATED_PART(LAYER_TRANSPARENT, 90, 1, 0, NULL),
                GEO_OPEN_NODE(),
                    GEO_ROTATION_NODE(LAYER_TRANSPARENT, 0, 0, -20),
                    GEO_OPEN_NODE(),
                        GEO_SCALE_WITH_DL(LAYER_TRANSPARENT, 0x14000, omm_peach_metal_foot_right_gfx),
                    GEO_CLOSE_NODE(),
                GEO_CLOSE_NODE(),
            GEO_CLOSE_NODE(),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_metal_vanish_right_leg_hidden[] = {
    GEO_ANIMATED_PART(LAYER_TRANSPARENT, -103, -8, -32, NULL),
    GEO_OPEN_NODE(),
        GEO_PREPROCESS_PEACH_RIGHT_LEG_POS,
        GEO_ANIMATED_PART(LAYER_TRANSPARENT, 0, 0, 0, NULL),
        GEO_OPEN_NODE(),
            GEO_ANIMATED_PART(LAYER_TRANSPARENT, 68, -4, 0, NULL),
            GEO_OPEN_NODE(),
                GEO_PREPROCESS_PEACH_RIGHT_FOOT_POS,
                GEO_ANIMATED_PART(LAYER_TRANSPARENT, 90, 1, 0, NULL),
            GEO_CLOSE_NODE(),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_metal_vanish_legs[] = {
    GEO_SWITCH_CASE(4, geo_switch_anim_state),
    GEO_OPEN_NODE(),
        GEO_TRANSLATE_NODE(LAYER_TRANSPARENT, 0, 0, 0),
        GEO_OPEN_NODE(),
            GEO_BRANCH(1, omm_geo_peach_metal_vanish_left_leg),
            GEO_BRANCH(1, omm_geo_peach_metal_vanish_right_leg),
        GEO_CLOSE_NODE(),
        GEO_TRANSLATE_NODE(LAYER_TRANSPARENT, 0, 0, 0),
        GEO_OPEN_NODE(),
            GEO_BRANCH(1, omm_geo_peach_metal_vanish_left_leg),
            GEO_BRANCH(1, omm_geo_peach_metal_vanish_right_leg_hidden),
        GEO_CLOSE_NODE(),
        GEO_TRANSLATE_NODE(LAYER_TRANSPARENT, 0, 0, 0),
        GEO_OPEN_NODE(),
            GEO_BRANCH(1, omm_geo_peach_metal_vanish_left_leg_hidden),
            GEO_BRANCH(1, omm_geo_peach_metal_vanish_right_leg),
        GEO_CLOSE_NODE(),
        GEO_TRANSLATE_NODE(LAYER_TRANSPARENT, 0, 0, 0),
        GEO_OPEN_NODE(),
            GEO_BRANCH(1, omm_geo_peach_metal_vanish_left_leg_hidden),
            GEO_BRANCH(1, omm_geo_peach_metal_vanish_right_leg_hidden),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_metal_vanish_dress[] = {
    GEO_TRANSLATE_NODE(LAYER_TRANSPARENT, -15, 0, 0),
    GEO_OPEN_NODE(),
        GEO_PREPROCESS_PEACH_HIPS_ROT_AND_LEGS,
        GEO_ROTATION_NODE(LAYER_TRANSPARENT, 0, 0, 0),
        GEO_OPEN_NODE(),
            GEO_DISPLAY_LIST(LAYER_TRANSPARENT, omm_peach_metal_hips_gfx),
            GEO_OPEN_NODE(),
                GEO_TRANSLATE_NODE(LAYER_TRANSPARENT, -96, -4, 0),
                GEO_OPEN_NODE(),
                    GEO_PREPROCESS_PEACH_DRESS_ROT,
                    GEO_ROTATION_NODE(LAYER_TRANSPARENT, 0, 0, 0),
                    GEO_OPEN_NODE(),
                        GEO_DISPLAY_LIST(LAYER_TRANSPARENT, omm_peach_metal_dress_gfx),
                    GEO_CLOSE_NODE(),
                GEO_CLOSE_NODE(),
            GEO_CLOSE_NODE(),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

static const GeoLayout omm_geo_peach_metal_vanish[] = {
    GEO_ANIMATED_PART(LAYER_TRANSPARENT, 0, 140, 0, NULL),
    GEO_OPEN_NODE(),
        GEO_PREPROCESS_PEACH_TORSO_POS,
        GEO_ANIMATED_PART(LAYER_TRANSPARENT, 0, 0, 0, omm_peach_metal_torso_gfx),
        GEO_OPEN_NODE(),
            GEO_ASM(0, geo_move_mario_part_from_parent),
            GEO_ASM(0, geo_mario_tilt_torso),
            GEO_ROTATION_NODE(LAYER_TRANSPARENT, 0, 0, 0),
            GEO_OPEN_NODE(),
                GEO_BRANCH(1, omm_geo_peach_axes),
                GEO_ANIMATED_PART(LAYER_TRANSPARENT, 29, 0, 0, omm_peach_metal_chest_gfx),
                GEO_OPEN_NODE(),
                    GEO_PREPROCESS_PEACH_HEAD_ROT,
                    GEO_ANIMATED_PART(LAYER_TRANSPARENT, 101, 0, 0, NULL),
                    GEO_OPEN_NODE(),
                        GEO_ASM(0, geo_mario_head_rotation),
                        GEO_ROTATION_NODE(LAYER_TRANSPARENT, 0, 0, 0),
                        GEO_OPEN_NODE(),
                            GEO_BRANCH(1, omm_geo_peach_metal_vanish_head),
                            GEO_BRANCH(1, omm_geo_peach_metal_vanish_cap_on_off),
                            GEO_BRANCH(1, omm_geo_peach_metal_vanish_eyes),
                        GEO_CLOSE_NODE(),
                    GEO_CLOSE_NODE(),
                    GEO_BRANCH(1, omm_geo_peach_metal_vanish_left_arm),
                    GEO_BRANCH(1, omm_geo_peach_metal_vanish_right_arm),
                    GEO_BRANCH(1, omm_geo_peach_metal_vanish_wings),
                GEO_CLOSE_NODE(),
            GEO_CLOSE_NODE(),
            GEO_BRANCH(1, omm_geo_peach_metal_vanish_legs),
            GEO_BRANCH(1, omm_geo_peach_metal_vanish_dress),
            GEO_DISPLAY_LIST(LAYER_TRANSPARENT, omm_peach_revert_gfx),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_RETURN(),
};

//
// Geo layout
//

const GeoLayout omm_geo_peach[] = {
    GEO_SHADOW(SHADOW_CIRCLE_PLAYER, 0xB4, 100),
    GEO_OPEN_NODE(),
        GEO_SCALE(0, 0x4000),
        GEO_OPEN_NODE(),
            GEO_ASM(0, geo_mirror_mario_backface_culling),
            GEO_ASM(0, geo_mirror_mario_set_alpha),
            GEO_OPEN_NODE(),
                GEO_NODE_START(),
                GEO_OPEN_NODE(),
                    GEO_RENDER_RANGE(-2048, 32767),
                    GEO_OPEN_NODE(),
                        GEO_SWITCH_CASE(0, geo_switch_mario_cap_effect),
                        GEO_OPEN_NODE(),
                            GEO_BRANCH(1, omm_geo_peach_normal),
                            GEO_BRANCH(1, omm_geo_peach_vanish),
                            GEO_BRANCH(1, omm_geo_peach_metal),
                            GEO_BRANCH(1, omm_geo_peach_metal_vanish),
                        GEO_CLOSE_NODE(),
                    GEO_CLOSE_NODE(),
                GEO_CLOSE_NODE(),
            GEO_CLOSE_NODE(),
            GEO_ASM(1, geo_mirror_mario_backface_culling),
        GEO_CLOSE_NODE(),
    GEO_CLOSE_NODE(),
    GEO_END(),
};